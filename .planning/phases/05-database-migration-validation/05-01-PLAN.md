---
phase: 05-database-migration-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/lib/db/schema.ts, src/lib/aws/dynamo.ts, src/lib/aws/s3-pointers.ts]
autonomous: true
---

<objective>
Define the DynamoDB single-table schema using ElectroDB and initialize the S3 pointer infrastructure for large transcripts.

Purpose: Establishes the data foundation for the serverless migration.
Output: ElectroDB entities for Campaigns and Sessions, and utility for S3 transcript storage.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-database-migration-validation/05-RESEARCH.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Setup ElectroDB Schema</name>
  <files>src/lib/db/schema.ts</files>
  <action>
    Install `electrodb`. 
    Create `src/lib/db/schema.ts` defining:
    - Campaign Entity: PK: `USER#${userId}`, SK: `CAMP#${campaignId}`
    - Session Entity: PK: `CAMP#${campaignId}`, SK: `SESS#${sessionId}`
    - Include all fields from `prisma/schema.prisma`.
    - Use `transcriptStorageKey` (string) instead of raw `transcript` in the Session entity.
  </action>
  <verify>Run a small script to instantiate the entities and log the PK/SK templates to ensure they match research recommendations.</verify>
  <done>ElectroDB entities exported and PK/SK structure validated.</done>
</task>

<task type="auto">
  <name>Task 2: S3 Pointer Utility</name>
  <files>src/lib/aws/s3-pointers.ts</files>
  <action>
    Create a utility to handle the "S3 Pointer Pattern":
    - `uploadTranscript(sessionId, content)`: Uploads to S3, returns the key.
    - `getTranscript(key)`: Retrieves content from S3.
    Use the existing AWS SDK v3 configurations.
  </action>
  <verify>Unit test with a mock S3 client or a small script to upload/download a string.</verify>
  <done>Transcripts can be saved to and retrieved from S3 via key pointers.</done>
</task>

<task type="auto">
  <name>Task 3: DynamoDB Client Initialization</name>
  <files>src/lib/aws/dynamo.ts</files>
  <action>
    Initialize the `@aws-sdk/client-dynamodb` and `DynamoDBDocumentClient`.
    Export a singleton instance for use by ElectroDB.
    Ensure it uses environment variables: `DYNAMODB_TABLE_NAME`, `AWS_REGION`.
  </action>
  <verify>Check that the client exports correctly and respects region/env vars.</verify>
  <done>DynamoDB client ready for application use.</done>
</task>

</tasks>

<verification>
Check if ElectroDB models can generate correct query parameters for a mock user/campaign.
</verification>

<success_criteria>
1. `electrodb` is in package.json.
2. `Campaign` and `Session` entities are defined with composite keys.
3. S3 pointer logic is implemented and tested.
</success_criteria>

<output>
After completion, create `.planning/phases/05-database-migration-validation/05-01-SUMMARY.md`
</output>
