---
phase: 05-database-migration-validation
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified: [scripts/migrate-to-dynamo.ts]
autonomous: true
---

<objective>
Create and execute a one-time migration script to transfer all existing PostgreSQL data (Campaigns, Sessions, Transcripts) to DynamoDB and S3.

Purpose: Synchronize legacy data with the new serverless storage.
Output: A script that iterates through Postgres records and populates DynamoDB/S3.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/05-database-migration-validation/05-02-SUMMARY.md
@prisma/schema.prisma
@src/lib/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migration Script Implementation</name>
  <files>scripts/migrate-to-dynamo.ts</files>
  <action>
    Create a script using `ts-node` that:
    1. Fetches all Campaigns from Postgres and writes to DynamoDB via ElectroDB.
    2. Fetches all Sessions from Postgres.
    3. For each Session:
       - Uploads the transcript to S3.
       - Writes the session item to DynamoDB with the S3 key.
    4. Implements basic progress tracking and error logging.
    5. Checks if item already exists in DynamoDB to allow for restarts.
  </action>
  <verify>Run the script in "dry run" mode (if implemented) or on a small subset of data.</verify>
  <done>Migration script ready and tested on sample data.</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Execute Migration & Verify Spot Checks</name>
  <files>scripts/migrate-to-dynamo.ts</files>
  <action>
    1. Run the migration script on the full dataset.
    2. Perform spot checks in the AWS Console for DynamoDB and S3.
    3. Compare counts: `SELECT count(*) FROM "Session"` vs items in DynamoDB.
  </action>
  <verify>
    - Total session count in Postgres matches DynamoDB count.
    - S3 bucket contains a number of objects corresponding to sessions with transcripts.
  </verify>
  <done>Legacy data successfully seeded into DynamoDB/S3.</done>
</task>

</tasks>

<verification>
Ensure every record in PostgreSQL has a corresponding record in DynamoDB with the same attributes.
</verification>

<success_criteria>
1. All legacy Campaigns migrated.
2. All legacy Sessions migrated.
3. All legacy Transcripts stored in S3.
4. No data loss during transfer.
</success_criteria>

<output>
After completion, create `.planning/phases/05-database-migration-validation/05-03-SUMMARY.md`
</output>
