---
phase: 1-foundation---recording-&-transcription
plan: 02
type: execute
wave: 2
depends_on: ["1-01"]
files_modified:
  - src/app/api/auth/[...nextauth]/route.ts
  - src/auth.ts
  - .env
  - package.json
autonomous: true
user_setup:
  - service: Auth.js
    why: "Secure authentication for user accounts"
    env_vars:
      - name: NEXTAUTH_SECRET
        source: "A long, random string (e.g., generated by `openssl rand -base64 32` or similar)"
    dashboard_config: []

must_haves:
  truths:
    - "Auth.js is correctly configured with Prisma adapter."
    - "Auth.js API routes are functional."
  artifacts:
    - path: "src/app/api/auth/[...nextauth]/route.ts"
      provides: "Auth.js API routes"
      min_lines: 20
    - path: "src/auth.ts"
      provides: "Auth.js configuration (providers, adapter, callbacks)"
      min_lines: 30
  key_links:
    - from: "src/auth.ts"
      to: "prisma.user"
      via: "PrismaAdapter"
      pattern: "PrismaAdapter(prisma)"
    - from: "src/app/api/auth/[...nextauth]/route.ts"
      to: "src/auth.ts"
      via: "NextAuth(authConfig)"
      pattern: "NextAuth(authConfig)"
---

<objective>
Implement core Auth.js (NextAuth.js) functionality using the Prisma adapter for backend authentication.

Purpose: Set up the essential server-side components for user authentication, providing secure endpoints that other plans will leverage.
Output: Configured Auth.js, working authentication API routes, and secure integration with Prisma.
</objective>

<execution_context>
@/home/ubuntu/.gemini/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md
@.planning/phases/1-foundation---recording-&-transcription/1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Auth.js dependencies and configure `src/auth.ts`</name>
  <files>
    package.json
    src/auth.ts
    .env
  </files>
  <action>
    Install `next-auth`, `@auth/prisma-adapter`, and `bcrypt` packages.
    Create `src/auth.ts` to configure Auth.js, defining a `CredentialsProvider` for email/password.
    Integrate `PrismaAdapter` to manage user sessions and data in the database using the `User` model from Plan 01.
    Add `NEXTAUTH_SECRET` to `.env` with a strong, random value.
    Ensure `bcrypt` is used for hashing passwords before storing them and for verification.
  </action>
  <verify>
    `npm list next-auth @auth/prisma-adapter bcrypt` shows packages installed.
    `src/auth.ts` exports `authConfig` with `CredentialsProvider` and `PrismaAdapter`.
    `.env` contains `NEXTAUTH_SECRET` with a value.
  </verify>
  <done>
    Auth.js core setup is complete with Prisma integration and secure password handling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Auth.js API Routes</name>
  <files>
    src/app/api/auth/[...nextauth]/route.ts
  </files>
  <action>
    Create the dynamic route handler `src/app/api/auth/[...nextauth]/route.ts` that exports `GET` and `POST` methods using the `authConfig` from `src/auth.ts`.
  </action>
  <verify>
    `src/app/api/auth/[...nextauth]/route.ts` exists and correctly imports and uses `authConfig`.
    `curl -X GET /api/auth/session` returns a session object (if logged in) or null (if not).
  </verify>
  <done>
    Auth.js API endpoints for authentication are functional.
  </done>
</task>

</tasks>

<verification>
1.  Ensure `NEXTAUTH_SECRET` is set in `.env`.
2.  Test `GET /api/auth/session` to confirm no user is logged in.
3.  Simulate a login POST request to `/api/auth/callback/credentials` (or through a test UI later) to verify the CredentialsProvider and PrismaAdapter are working.
4.  After simulated login, `GET /api/auth/session` should return user data.
</verification>

<success_criteria>
- Auth.js is installed and configured with Prisma adapter.
- Server-side authentication API routes are functional for login, logout, and session management.
- User passwords are securely handled with hashing.
</success_criteria>

<output>
After completion, create `.planning/phases/1-foundation---recording-&-transcription/1-02-SUMMARY.md`
</output>