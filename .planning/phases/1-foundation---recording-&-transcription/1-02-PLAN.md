---
phase: 1-foundation---recording-&-transcription
plan: 02
type: execute
wave: 2
depends_on: ["1-01"]
files_modified:
  - src/app/api/auth/[...nextauth]/route.ts
  - src/auth.ts
  - src/components/auth-forms.tsx # Example UI component
  - src/middleware.ts
  - .env
autonomous: true
user_setup:
  - service: Auth.js
    why: "Secure authentication for user accounts"
    env_vars:
      - name: NEXTAUTH_SECRET
        source: "A long, random string (e.g., generated by `openssl rand -base64 32` or similar)"
    dashboard_config: []

must_haves:
  truths:
    - "Users can successfully create an account."
    - "Users can log in using their credentials."
    - "Users can securely log out."
    - "Unauthenticated users are redirected from protected routes."
  artifacts:
    - path: "src/app/api/auth/[...nextauth]/route.ts"
      provides: "Auth.js API routes"
      min_lines: 20
    - path: "src/auth.ts"
      provides: "Auth.js configuration (providers, adapter, callbacks)"
      min_lines: 30
    - path: "src/components/auth-forms.tsx"
      provides: "UI for sign-in/sign-up/sign-out"
      min_lines: 50
  key_links:
    - from: "src/auth.ts"
      to: "prisma.user"
      via: "PrismaAdapter"
      pattern: "PrismaAdapter(prisma)"
    - from: "src/app/api/auth/[...nextauth]/route.ts"
      to: "src/auth.ts"
      via: "NextAuth(authConfig)"
      pattern: "NextAuth(authConfig)"
    - from: "src/components/auth-forms.tsx"
      to: "/api/auth/signin"
      via: "signIn('credentials', ...)"
      pattern: "signIn\('credentials'"
---

<objective>
Implement secure user authentication using Auth.js (NextAuth.js) with the Prisma adapter.

Purpose: Enable users to create accounts, log in, and log out, fulfilling AUTH-01. This is crucial for protecting user data and session-related operations.
Output: Working authentication endpoints, basic protected routes, and UI components for user interaction.
</objective>

<execution_context>
@/home/ubuntu/.gemini/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md
@.planning/phases/1-foundation---recording-&-transcription/1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Auth.js with Credentials Provider and Prisma Adapter</name>
  <files>
    package.json
    src/auth.ts
    .env
  </files>
  <action>
    Install Auth.js and the Prisma adapter.
    Create `src/auth.ts` to configure Auth.js.
    Define a `CredentialsProvider` for email/password login.
    Integrate `PrismaAdapter` to manage user sessions and data in the database using the `User` model from Plan 01.
    Add `NEXTAUTH_SECRET` to `.env`.
    Ensure password hashing (e.g., bcrypt) is used for storing and verifying user passwords.
  </action>
  <verify>
    `npm list next-auth @auth/prisma-adapter bcrypt` shows installed packages.
    `src/auth.ts` exports a valid `authConfig` with CredentialsProvider and PrismaAdapter.
    `.env` contains `NEXTAUTH_SECRET`.
  </verify>
  <done>
    Auth.js is configured with credentials provider and Prisma for user management.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Auth.js API Routes and Middleware</name>
  <files>
    src/app/api/auth/[...nextauth]/route.ts
    src/middleware.ts
  </files>
  <action>
    Create the dynamic route handler `src/app/api/auth/[...nextauth]/route.ts` that exports `GET` and `POST` methods using `authConfig`.
    Implement `src/middleware.ts` to protect application routes, redirecting unauthenticated users to a login page. Exclude `_next/*`, `api/auth/*` from middleware protection.
  </action>
  <verify>
    `src/app/api/auth/[...nextauth]/route.ts` is created and correctly imports `authConfig`.
    `src/middleware.ts` is present and redirects unauthenticated users for protected routes.
  </verify>
  <done>
    Auth.js API endpoints are functional, and middleware protects application routes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement Basic Auth UI (Sign-in, Sign-up, Sign-out)</name>
  <files>
    src/app/page.tsx # Example homepage for login/logout buttons
    src/app/protected/page.tsx # Example protected page
    src/components/auth-forms.tsx # Contains login/signup/logout components
  </files>
  <action>
    Create basic React components for user sign-in and sign-up forms that interact with the Auth.js API routes.
    Add a sign-out button.
    Create a simple `src/app/protected/page.tsx` that can only be accessed by authenticated users.
    Update `src/app/page.tsx` to include links to login/signup or a logout button if authenticated.
  </action>
  <verify>
    The application successfully handles new user registration, logs in existing users, and allows users to log out.
    Navigating to `/protected` as an unauthenticated user redirects to the login page.
    Navigating to `/protected` as an authenticated user shows the protected content.
  </verify>
  <done>
    Full authentication flow (signup, login, logout, protected routes) is functional end-to-end.
  </done>
</task>

</tasks>

<verification>
1.  Attempt to register a new user via the UI. Verify user is created in the database.
2.  Log in with the newly created user. Verify successful login and ability to access `/protected`.
3.  Log out. Verify redirection and inability to access `/protected`.
4.  Attempt to access `/protected` without logging in. Verify redirection to login.
</verification>

<success_criteria>
- User authentication (sign-up, sign-in, sign-out) is fully functional.
- Application routes can be protected, redirecting unauthenticated users.
- User data is securely stored and managed by Auth.js and Prisma.
</success_criteria>

<output>
After completion, create `.planning/phases/1-foundation---recording-&-transcription/1-02-SUMMARY.md`
</output>
