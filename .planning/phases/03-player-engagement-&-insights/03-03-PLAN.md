---
phase: 03-player-engagement-&-insights
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified: [src/app/share/[shareToken]/page.tsx, src/components/ExportControls.tsx, src/components/PDFRecap.tsx, src/app/sessions/[id]/page.tsx]
autonomous: true
---

<objective>
Implement the public sharing and export functionality for player recaps.

Purpose: Allow players to access their recaps without a login and provide professional export options (PDF, Clipboard).
Output: Public recap route, PDF generation component, and export control UI.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-player-engagement-&-insights/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Setup Public Sharing Route</name>
  <files>src/app/share/[shareToken]/page.tsx, src/lib/actions/session.ts</files>
  <action>
    1. Implement a Server Component at `/share/[shareToken]` that:
       - Fetches the session by `shareToken` (not `id`).
       - Displays ONLY the session name, date, and `playerRecap`.
       - Does NOT require authentication (public view).
    2. Add a server action to generate/refresh the `shareToken` using `nanoid(12)` if it doesn't exist.
  </action>
  <verify>Access `/share/some-nano-id` and see the recap without being logged in.</verify>
  <done>Public, obfuscated sharing route is operational.</done>
</task>

<task type="auto">
  <name>Task 2: Implement PDF Export</name>
  <files>src/components/PDFRecap.tsx</files>
  <action>
    Create a `PDFRecap` component using `@react-pdf/renderer` that:
    - Defines a clean, readable layout for the recap.
    - Includes the campaign name, session name, and the recap text.
    - Note: Ensure this is used with `next/dynamic` { ssr: false } to avoid SSR issues.
  </action>
  <verify>Open the PDF preview or trigger a download and check the layout.</verify>
  <done>Recaps can be rendered into professional-looking PDFs.</done>
</task>

<task type="auto">
  <name>Task 3: Export Controls and Clipboard</name>
  <files>src/components/ExportControls.tsx, src/app/sessions/[id]/page.tsx</files>
  <action>
    1. Create `ExportControls.tsx` with three buttons:
       - "Copy Text": Uses `navigator.clipboard` to copy the recap as formatted text.
       - "Download PDF": Triggers the `@react-pdf/renderer` download.
       - "Copy Link": Copies the full `/share/[shareToken]` URL.
    2. Integrate these controls into the Session detail page (visible to GMs).
  </action>
  <verify>Test each button: confirm text is in clipboard, PDF downloads, and share link works.</verify>
  <done>GMs have multiple ways to share session outcomes with players.</done>
</task>

</tasks>

<verification>
- Confirm share link is obfuscated (not an integer ID).
- Verify PDF handles longer recaps with page breaks.
- Ensure public share page doesn't leak GM notes or transcript.
</verification>

<success_criteria>
- Export Options: Copy-to-clipboard, PDF, and Shareable link are all implemented.
- Public route correctly displays the player recap based on a unique token.
</success_criteria>

<output>
After completion, create `.planning/phases/03-player-engagement-&-insights/03-03-SUMMARY.md`
</output>
