---
phase: 02-core-value---ai-summarization-&-search
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [prisma/schema.prisma, src/lib/inngest/client.ts, src/app/api/inngest/route.ts]
autonomous: true
---

<objective>
Update the database schema to support Campaigns and AI summaries, and initialize the Inngest background job infrastructure.

Purpose: Campaigns provide the structural hierarchy for sessions (DASH-01), and Inngest handles long-running AI tasks without timing out (AI-01).
Output: Updated Prisma schema, working Inngest client, and background job endpoint.
</objective>

<execution_context>
@./.gemini/get-shit-done/workflows/execute-plan.md
@./.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Schema for Campaigns & AI</name>
  <files>prisma/schema.prisma</files>
  <action>
    Modify `prisma/schema.prisma`:
    1. Add `Campaign` model:
       - `id` (UUID, PK)
       - `name` (String)
       - `description` (String, optional)
       - `userId` (String, FK to User)
       - `user` (Relation)
       - `sessions` (Relation to Session[])
       - `createdAt`, `updatedAt` (DateTime)
    2. Update `Session` model:
       - Add `campaignId` (String, optional FK to Campaign)
       - Add `campaign` (Relation)
       - Add `summary` (String, optional) - For AI summaries
       - Add `transcriptText` (String, optional) - For FTS and AI context
    3. Run `npx prisma migrate dev --name add_campaigns_and_summary_fields`.
  </action>
  <verify>Run `npx prisma validate` and check `migrations` folder for the new SQL file.</verify>
  <done>Schema includes Campaign model and new Session fields; migrations applied.</done>
</task>

<task type="auto">
  <name>Task 2: Setup Inngest Infrastructure</name>
  <files>src/lib/inngest/client.ts, src/app/api/inngest/route.ts, package.json</files>
  <action>
    1. Install inngest: `npm install inngest`.
    2. Create `src/lib/inngest/client.ts` to export a new `Inngest` instance named "RPG Recorder".
    3. Create `src/app/api/inngest/route.ts` using `serve` from `inngest/next` to handle background job requests.
  </action>
  <verify>
    Run `npx inngest-cli@latest dev` (if possible) or verify the API route returns a 200/405 instead of 404 when visited at `/api/inngest`.
  </verify>
  <done>Inngest client initialized and API route serving background jobs.</done>
</task>

</tasks>

<verification>
- Prisma schema is valid and migrations applied.
- Inngest client and route exist.
</verification>

<success_criteria>
- Campaign model exists in DB.
- Session has summary and transcriptText fields.
- /api/inngest endpoint is reachable.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-value---ai-summarization-&-search/02-01-SUMMARY.md`
</output>
